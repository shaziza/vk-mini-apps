{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _getClassName = _interopRequireDefault(require(\"../../helpers/getClassName\"));\n\nvar _classNames = _interopRequireDefault(require(\"../../lib/classNames\"));\n\nvar _platform = require(\"../../lib/platform\");\n\nvar _supportEvents = require(\"../../lib/supportEvents\");\n\nvar _withPlatform = _interopRequireDefault(require(\"../../hoc/withPlatform\"));\n\nvar _dom = require(\"../../lib/dom\");\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = (0, _getPrototypeOf2.default)(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2.default)(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return (0, _possibleConstructorReturn2.default)(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nvar PopoutWrapper = /*#__PURE__*/function (_Component) {\n  (0, _inherits2.default)(PopoutWrapper, _Component);\n\n  var _super = _createSuper(PopoutWrapper);\n\n  function PopoutWrapper(props) {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, PopoutWrapper);\n    _this = _super.call(this, props);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"elRef\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"animationFinishTimeout\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"onFadeInEnd\", function (e) {\n      if (!e || e.animationName === 'animation-full-fade-in') {\n        _this.setState({\n          opened: true\n        });\n      }\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"preventTouch\", function (e) {\n      return e.preventDefault();\n    });\n    _this.state = {\n      opened: false\n    };\n    _this.elRef = /*#__PURE__*/_react.default.createRef();\n    return _this;\n  }\n\n  (0, _createClass2.default)(PopoutWrapper, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (_dom.canUseDOM) {\n        window.addEventListener('touchmove', this.preventTouch, {\n          passive: false\n        });\n        this.waitAnimationFinish(this.elRef.current, this.onFadeInEnd);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      // Здесь нужен последний аргумент с такими же параметрами, потому что\n      // некоторые браузеры на странных вендорах типа Meizu не удаляют обработчик.\n      // https://github.com/VKCOM/VKUI/issues/444\n      if (_dom.canUseDOM) {\n        // @ts-ignore (В интерфейсе EventListenerOptions нет поля passive)\n        window.removeEventListener('touchmove', this.preventTouch, {\n          passive: false\n        });\n        clearTimeout(this.animationFinishTimeout);\n      }\n    }\n  }, {\n    key: \"waitAnimationFinish\",\n    value: function waitAnimationFinish(elem, eventHandler) {\n      if (_supportEvents.animationEvent.supported) {\n        elem.removeEventListener(_supportEvents.animationEvent.name, eventHandler);\n        elem.addEventListener(_supportEvents.animationEvent.name, eventHandler);\n      } else {\n        clearTimeout(this.animationFinishTimeout);\n        this.animationFinishTimeout = setTimeout(eventHandler, this.props.platform === _platform.ANDROID ? 200 : 300);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          alignY = _this$props.alignY,\n          alignX = _this$props.alignX,\n          closing = _this$props.closing,\n          children = _this$props.children,\n          hasMask = _this$props.hasMask,\n          className = _this$props.className,\n          platform = _this$props.platform,\n          restProps = (0, _objectWithoutProperties2.default)(_this$props, [\"alignY\", \"alignX\", \"closing\", \"children\", \"hasMask\", \"className\", \"platform\"]);\n      var baseClassNames = (0, _getClassName.default)('PopoutWrapper', platform);\n      return /*#__PURE__*/_react.default.createElement(\"div\", (0, _extends2.default)({}, restProps, {\n        className: (0, _classNames.default)(baseClassNames, \"PopoutWrapper--v-\".concat(alignY), \"PopoutWrapper--h-\".concat(alignX), {\n          'PopoutWrapper--closing': closing,\n          'PopoutWrapper--opened': this.state.opened\n        }, className),\n        ref: this.elRef\n      }), hasMask && /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"PopoutWrapper__mask\"\n      }), /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"PopoutWrapper__container\"\n      }, children));\n    }\n  }]);\n  return PopoutWrapper;\n}(_react.Component);\n\n(0, _defineProperty2.default)(PopoutWrapper, \"defaultProps\", {\n  hasMask: true,\n  alignY: 'center',\n  alignX: 'center',\n  closing: false\n});\n\nvar _default = (0, _withPlatform.default)(PopoutWrapper);\n\nexports.default = _default;","map":{"version":3,"sources":["../../../src/components/PopoutWrapper/PopoutWrapper.tsx"],"names":["PopoutWrapper","Component","opened","React","hasMask","alignY","alignX","closing","canUseDOM","window","passive","clearTimeout","elem","eventHandler","animationEvent","setTimeout","ANDROID","e","children","className","platform","restProps","baseClassNames","elRef"],"mappings":"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","sourcesContent":["import React, { Component, HTMLAttributes, MouseEvent } from 'react';\nimport getClassName from '../../helpers/getClassName';\nimport classNames from '../../lib/classNames';\nimport { ANDROID } from '../../lib/platform';\nimport { animationEvent } from '../../lib/supportEvents';\nimport withPlatform from '../../hoc/withPlatform';\nimport { HasPlatform } from '../../types';\nimport { canUseDOM } from '../../lib/dom';\n\nexport interface PopoutWrapperProps extends HTMLAttributes<HTMLDivElement>, HasPlatform {\n  hasMask?: boolean;\n  alignY?: 'top' | 'center' | 'bottom';\n  alignX?: 'left' | 'center' | 'right';\n  closing?: boolean;\n}\n\nexport interface PopoutWrapperState {\n  opened: boolean;\n}\n\nexport type WindowTouchListener = (e: Event) => void;\n\nexport type AnimationEndCallback = (e?: AnimationEvent) => void;\n\nexport type ClickHandler = (e: MouseEvent<HTMLDivElement>) => void;\n\nclass PopoutWrapper extends Component<PopoutWrapperProps, PopoutWrapperState> {\n  constructor(props: PopoutWrapperProps) {\n    super(props);\n    this.state = {\n      opened: false,\n    };\n    this.elRef = React.createRef();\n  }\n\n  static defaultProps: PopoutWrapperProps = {\n    hasMask: true,\n    alignY: 'center',\n    alignX: 'center',\n    closing: false,\n  };\n\n  elRef: React.RefObject<HTMLDivElement>;\n\n  private animationFinishTimeout: ReturnType<typeof setTimeout>;\n\n  componentDidMount() {\n    if (canUseDOM) {\n      window.addEventListener('touchmove', this.preventTouch, { passive: false });\n      this.waitAnimationFinish(this.elRef.current, this.onFadeInEnd);\n    }\n  }\n\n  componentWillUnmount() {\n    // Здесь нужен последний аргумент с такими же параметрами, потому что\n    // некоторые браузеры на странных вендорах типа Meizu не удаляют обработчик.\n    // https://github.com/VKCOM/VKUI/issues/444\n    if (canUseDOM) {\n      // @ts-ignore (В интерфейсе EventListenerOptions нет поля passive)\n      window.removeEventListener('touchmove', this.preventTouch, { passive: false });\n      clearTimeout(this.animationFinishTimeout);\n    }\n  }\n\n  waitAnimationFinish(elem: HTMLDivElement, eventHandler: AnimationEndCallback) {\n    if (animationEvent.supported) {\n      elem.removeEventListener(animationEvent.name, eventHandler);\n      elem.addEventListener(animationEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.animationFinishTimeout);\n      this.animationFinishTimeout = setTimeout(eventHandler, this.props.platform === ANDROID ? 200 : 300);\n    }\n  }\n\n  onFadeInEnd: AnimationEndCallback = (e: AnimationEvent) => {\n    if (!e || e.animationName === 'animation-full-fade-in') {\n      this.setState({ opened: true });\n    }\n  };\n\n  preventTouch: WindowTouchListener = (e: Event) => e.preventDefault();\n\n  render() {\n    const { alignY, alignX, closing, children, hasMask, className, platform, ...restProps } = this.props;\n    const baseClassNames = getClassName('PopoutWrapper', platform);\n\n    return (\n      <div\n        {...restProps}\n        className={classNames(baseClassNames, `PopoutWrapper--v-${alignY}`, `PopoutWrapper--h-${alignX}`, {\n          'PopoutWrapper--closing': closing,\n          'PopoutWrapper--opened': this.state.opened,\n        }, className)}\n        ref={this.elRef}\n      >\n        {hasMask && <div className=\"PopoutWrapper__mask\" />}\n        <div className=\"PopoutWrapper__container\">{children}</div>\n      </div>\n    );\n  }\n}\n\nexport default withPlatform(PopoutWrapper);\n"]},"metadata":{},"sourceType":"script"}